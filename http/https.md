HTTPS 协议是由 HTTP 加上 TLS/SSL 协议构建的可进行加密传输、身份认证的网络协议。TLS的前身是SSL，TLS1.0就是SSL3.1，TLS1.1是SSL3.2，TLS1.2则是SSL3.3。HTTPS标准端口是443。TLS/SSL中使用了非对称加密，对称加密以及Hash算法。

### 证书产生过程

1. 向CA机构提交申请，提交信息包括：

    - 公司信息
    - 加密算法（例如：RSA）
    - Hash签名算法（例如：sha256）
    - 加密位数
    - 域名

2. CA机构收到证书申请，发送证书和私钥给申请者，证书包含这些信息：

    - 证书内容(域名、公钥、有效期等等)
    - 证书签名（Hash算法对内容摘要，CA机构再用自己的私钥对摘要进行加密产生签名）

> 签名就是在信息的后面再加上一段内容

> CA机构发送给申请者的私钥和证书中公钥是一对。这里的公钥用于加密，私钥用于解密。

### https 连接过程

1. 客户端发送Client Hello给服务端，包含以下信息：

    - 支持的TLS版本
    - 支持的加密方式
    - 随机数
    - Session ID
    - 客户端的当前时间
    - 域名

2. 服务端收到请求后，发送server Hello，包含以下信息：

    - 确定TLS版本
    - 随机数
    - 确定加密方式
    - 证书
        - 内容(域名、公钥、有效期等等)
        - 签名
    - 时间
    - Session ID

3. 客户端收到请求后，将会做一下事情：

    - 验证证书

        - 操作系统和浏览器中存有CA机构的公钥。 客户端使用CA机构的公钥对签名进行解密，解密成功说明证书由CA机构颁发。
        - 签名成功解密后得到证书摘要。客户端使用Hash签名算法对证书内容进行摘要，然后和签名解密后的摘要比较，相等说明证书没有被修改过。证书内容（公钥、域名、有效期）可信。
        - 客户端验证证书内容的域名是否和当前网址是一致的，证书是否过期。

    - 生成随机数

        - 验证通过后，客户端生成随机数（对称密钥），然后用证书中的公钥进行加密，发送给服务端
        - 使用约定好的HASH算法加密方式计算握手消息
        - 使用生成的随机数对消息进行加密
        - 然后发送给服务端

4. 服务端

    - 服务端使用CA机构给的密钥对加密的随机数进行解密，获取随机数
    - 根据解密后的随机数，以及客户端第一次请求发给服务端的随机数和服务端第一次响应发给客户端的随机数，生成session key和mac算法密钥。
    - 根据session key和mac算法密钥对传输内容进行加密，再发送给客户端。具体加密过程：

        - mac密钥对内容进行摘要
        - 再用session key对摘要进行加密

5. 客户端

    - 客户端接收到服务端的数据后，先使用server_write_key进行解密（server_wirte_key怎么来的）
    - 再用server_write_MAC_key对数据完整性进行验证。（server_write_MAC_key怎么来的）



6. 服务端

    - 服务端接收到客户端的数据后，先使用client_write_key进行解密（client_write_key怎么来的）
    - 再用client_write_MAC_key对数据完整性进行验证。（client_write_MAC_key怎么来的）


> 第一步要确认服务端的身份是否可信，才能进行进行下面的数据传输。证书的作用就是确认服务端身份，确认证书来自权威可信机构，且证书内容未作修改，证书内容可信，证书内容有效，从而确认服务端的身份（身份确认）。

> 服务端证书可信后，再使用申请证书时生成的公钥对随机数加密，服务端收到后用申请证书时生成的私钥解密。保证了随机数的安全性，不会被第三方解密获取。

> 根据随机数加密和解密传输内容，保证内容不被泄露，所以随机数保密十分重要。

### 加密算法

- 非对称加密算法：RSA，DSA/DSS
- 对称加密算法：AES，RC4，3DES
- Hash算法：MD5，SHA1，SHA256